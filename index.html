<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <title>Abstract Generative Animation - Controllable Turbulence</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.js"></script>
    <style>
      /* Basic styling for the page */
      body {
        margin: 0;
        padding: 0;
        background-color: #1a1a1a; /* Dark background */
        font-family: "Inter", sans-serif;
        overflow: hidden; /* Prevent scrollbars for fullscreen canvas */
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        position: relative; /* For positioning the slider */
      }
      /* Styling for the canvas element itself */
      canvas {
        display: block; /* Removes extra space below canvas */
      }
      /* Styling for the turbulence slider */
      #turbulenceSlider {
        position: absolute;
        left: 25px; /* Distance from the left edge */
        top: 50%; /* Center vertically */
        transform: translateY(-50%) rotate(270deg); /* Rotate to be vertical */
        transform-origin: left top; /* Rotate around the top-left corner */
        width: 150px; /* Length of the slider */
        height: 20px; /* Thickness of the slider track */
        z-index: 10; /* Ensure it's above the canvas */
        background: rgba(255, 255, 255, 0.1); /* Semi-transparent background */
        border-radius: 10px;
        -webkit-appearance: none; /* Override default appearance */
        appearance: none;
      }

      #turbulenceSlider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 25px; /* Width of the thumb */
        height: 25px; /* Height of the thumb */
        background: #4caf50; /* Green thumb */
        cursor: pointer;
        border-radius: 50%;
        border: 2px solid #fff;
      }

      #turbulenceSlider::-moz-range-thumb {
        width: 25px;
        height: 25px;
        background: #4caf50;
        cursor: pointer;
        border-radius: 50%;
        border: 2px solid #fff;
      }

      /* Label for the slider */
      #sliderLabel {
        position: absolute;
        /* Slider's visual X-range [25px, 45px]. Visual Y-range [50%-160px, 50%-10px] */
        left: 25px; /* Align with slider's left edge */
        top: calc(
          50% - 10px + 15px
        ); /* Slider's visual bottom is at 50%-10px. Add 15px padding. So, 50%+5px */
        color: #ccc;
        font-size: 12px;
        z-index: 10;
        /* Removed writing-mode, text-orientation, and transform for simple horizontal text */
      }
    </style>
  </head>
  <body>
    <label id="sliderLabel" for="turbulenceSlider">Turbulence</label>
    <input type="range" id="turbulenceSlider" min="1" max="200" value="50" />

    <script>
      // Global variable for time, a core component of the animation
      let t;
      // Variables for the jellyfish's center position
      let offsetX, offsetY;

      // Perlin noise variables for smooth movement
      let noiseTimeX;
      let noiseTimeY;
      // let noiseIncrement = 0.005; // Base value, will be controlled by slider

      // Approximate radius of the jellyfish pattern to keep it on screen
      const jellyfishRadius = 220; // Adjust if needed based on visual size

      // Slider element
      let turbulenceSliderEl;

      // p5.js setup function: runs once when the program starts
      function setup() {
        // Create a canvas that fills the entire window
        createCanvas(windowWidth, windowHeight);

        // Get the slider element
        turbulenceSliderEl = document.getElementById("turbulenceSlider");

        // Initialize the global time variable for the pattern's internal animation
        t = 0;

        // Initialize Perlin noise time offsets randomly
        noiseTimeX = random(1000); // Start at a random point in noise space
        noiseTimeY = random(2000); // Start at a different random point

        // Initialize the jellyfish's starting position using noise to avoid starting at an edge
        offsetX = map(
          noise(noiseTimeX),
          0,
          1,
          jellyfishRadius,
          width - jellyfishRadius
        );
        offsetY = map(
          noise(noiseTimeY),
          0,
          1,
          jellyfishRadius,
          height - jellyfishRadius
        );
      }

      // The core drawing function 'a' from the original tweet, translated to JS
      function calculatePoint(x_param, y_param) {
        let k_val = 9 * cos(x_param / 8);
        let e_val = y_param / 8 - 12.5;
        let d_calc = (k_val * k_val + e_val * e_val) / 99 + sin(t) / 6 + 0.5;
        let q_val =
          99 -
          (e_val * sin(atan2(k_val, e_val) * 7)) / d_calc +
          k_val * (3 + cos(d_calc * d_calc - t) * 2);
        let c_val = d_calc / 2 + e_val / 69 - t / 16;

        point(
          q_val * sin(c_val) + offsetX,
          (q_val + 19 * d_calc) * cos(c_val) + offsetY
        );
      }

      // p5.js draw function: runs repeatedly, creating the animation frames
      function draw() {
        background(9);
        stroke(255, 66);
        strokeWeight(1);

        // Increment time for internal animation of the jellyfish structure
        t += PI / 45;

        // Get turbulence value from slider
        // Slider range is 1-200. Map this to a suitable noiseIncrement range.
        // Example: map(sliderValue, 1, 200, 0.0001, 0.02)
        let sliderValue = parseFloat(turbulenceSliderEl.value);
        let currentNoiseIncrement = map(sliderValue, 1, 200, 0.0001, 0.015);

        // Update Perlin noise time offsets
        noiseTimeX += currentNoiseIncrement;
        noiseTimeY += currentNoiseIncrement;

        // Calculate new target position using Perlin noise for smooth movement
        let targetX = map(
          noise(noiseTimeX),
          0,
          1,
          jellyfishRadius,
          width - jellyfishRadius
        );
        let targetY = map(
          noise(noiseTimeY),
          0,
          1,
          jellyfishRadius,
          height - jellyfishRadius
        );

        offsetX = targetX;
        offsetY = targetY;

        // Ensure the jellyfish's center is constrained
        offsetX = constrain(offsetX, jellyfishRadius, width - jellyfishRadius);
        offsetY = constrain(offsetY, jellyfishRadius, height - jellyfishRadius);

        // Loop 10,000 times to draw points for the current frame
        for (let i = 10000; i >= 1; i--) {
          calculatePoint(i % 200, i / 55);
        }
      }

      // This function is called by p5.js whenever the browser window is resized
      function windowResized() {
        resizeCanvas(windowWidth, windowHeight);
        offsetX = constrain(
          map(
            noise(noiseTimeX),
            0,
            1,
            jellyfishRadius,
            width - jellyfishRadius
          ),
          jellyfishRadius,
          width - jellyfishRadius
        );
        offsetY = constrain(
          map(
            noise(noiseTimeY),
            0,
            1,
            jellyfishRadius,
            height - jellyfishRadius
          ),
          jellyfishRadius,
          height - jellyfishRadius
        );
      }
    </script>
  </body>
</html>
